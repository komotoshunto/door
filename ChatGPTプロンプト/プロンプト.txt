"""

"""

あなたは、上記の部屋名称のリストから「名称のバリエーション」を代表名称（= ベース名）に統合する変換器です。以下の仕様に厳密に従い、最終的に Python のリストのみを出力してください。


## 1. 目的

各サブリスト内で同じベース名に属する名称群をまとめ、各要素の'名前'を代表名称（ベース名 + まとめたバリエーション列）に置換した平坦化リストを返します。サブリスト間では比較・統合しません。


## 2. 入力フォーマット

* 入力は Python の リスト（第1階層）。要素はサブリスト（第2階層）。
* 各サブリストは辞書のリスト。各辞書は少なくとも `{'ID': <str>, '名前': <str>}` を持ちます。
* 入力例：

  ```
  [[{'ID': 382014, '名前': 'PS5'}, {'ID': 650392, '名前': 'SK'}, {'ID': 941205, '名前': '事務室5'}, {'ID': 128504, '名前': 'PS2'}, {'ID': 507326, '名前': 'EPS1'}],
   [{'ID': 104582, '名前': '事務室2'}, {'ID': 205713, '名前': 'EPS3'}, {'ID': 396824, '名前': '事務室1'}, {'ID': 587935, '名前': 'WC'}, {'ID': 768046, '名前': '事務室3'}]]
  ```


## 3. スコープと順序（重要）

* 比較と統合は各サブリスト内でのみ行う（第2階層を超えて比較しない）。
* 出力は、全サブリストの要素を入力順（サブリストの順→各サブリスト内の順）で平坦化した 1 本のリスト。


## 4. 用語定義

* ベース名：名称から「バリエーション部分」を取り除いた不変部分。先頭（接頭）または末尾（接尾）の一方にバリエーションが付くとみなします。
* バリエーション部分：下記 5. の許可パターンに完全一致する連続文字列。
  ※ 同一グループ内では、バリエーションは同じ側（先頭 or 末尾）に付くこと。


## 5. バリエーションとして認めるパターン（完全一致）

以下のいずれかに一致する場合のみバリエーションとして扱います。これら以外はバリエーション扱いにしません。

A. 数字系

* 半角/全角の数字のみ（例：'101', '２', '06'）
* `-` に続く数字、またはその繰り返し（例：'-1', '-10', '-2-3'）
* `_` に続く数字のみ（例：'_1', '_10'）

B. 記号付き英字

* `-` に続く英字のみ（例：'-A', '-B'）

C. 短いトークン（方角等）

* 1〜2文字の英字/ひらがな/カタカナ/漢字（例：'A', 'B', '北', '南', '北東'）

D. 合成形（C + A の組み合わせ）

* C のトークンに `-数字` または `_数字` が続く形（例：'B-53', 'C-7', '南_01'）

> 禁止：`_` の直後が英字列（例：'_Main', '_Backup'）は不許可。バリエーションとはみなしません（= まとめない）。


## 6. まとめる条件

* 同一サブリスト内で、同じ側（先頭/末尾）の切り出しにより得られるベース名が完全一致し、かつそのベース名に属する許可パターンのバリエーションが 2 件以上ある場合のみ、まとめます。
* 先頭/末尾の両解釈が可能な名称が混在する場合は、2 件以上が同一ベース名で一致する側を採用。
* 条件を満たさない名称は元の名称のまま（まとめない）。


## 7. まとめない（統合禁止）ケース

* ベース名が完全一致しない（共通語があっても不可）。
  例：'イベントスペースA' と '展示スペースB' は別。
* 5. の許可パターンに完全一致しない付加部分（例：'_Main'）はバリエーション扱いしない。
     例：'ServerZone_1', 'ServerZone_2', 'ServerZone_Main' → '_1', '_2' はまとめ可、'_Main' は個別のまま。


## 8. 代表名称の作成・表記規則

8.1 代表名称の形

* 接尾型（末尾にバリエーション）：
  `"<ベース名><半角スペース><変種1>, <変種2>, ..."`
  例：'PS 2, 5', '事務室 1, 2, 3', 'ServerZone _1, _2'
* 接頭型（先頭にバリエーション）：
  `"<変種1>, <変種2>, ...<半角スペース><ベース名>"`
  例：'北, 東 テラス', '北, 北東, 南_01, 南_3 ギャラリー'

8.2 正規化

1. 数字は半角に統一（'２'→'2'）。
2. 文字列の前後空白は除去。
3. `-` や `_` は元名称に存在する場合のみ保持（付加・削除しない）。
4. 数字のゼロ埋めは元表記を保持（例：'06' は '06' のまま）。
5. カンマは半角、区切りは「, 」（カンマ+半角スペース）。

8.3 ソートと重複除去

* 同一グループ内のバリエーションは重複除去してから整列。
* ソート規則：

  * グループ内の全バリエーションが「数字のみ」「`-数字`」「`_数字`」「合成形（C + 数字）」の数値系のみで構成される場合：
    → 数字部分の数値昇順（表示は原表記を維持）。
  * 上記以外（英字/漢字/合成が混在）の場合：
    → 半角化後の文字列の辞書順。


## 9. 出力仕様（厳守）

* 返すのは Python のリスト（平坦化） のみ：
  `[{ 'ID': <int>, '名前': <str> }, ...]`
* 各要素は入力の各辞書に 1 対 1で対応し、'ID' はそのまま、'名前' は以下のいずれか：

  * まとめ対象に属する場合：代表名称（8. の形式）。
  * まとめない場合：元の名称。
* 説明文・コメント・コードブロック等は一切出力しないこと（Python のリストのみ）。


## 10. 例（期待される変換）

* 上記「2. 入力例」に対する正しい出力：

  ```
  [{'ID': 382014, '名前': 'PS 2, 5'},
   {'ID': 650392, '名前': 'SK'},
   {'ID': 941205, '名前': '事務室5'},
   {'ID': 128504, '名前': 'PS 2, 5'},
   {'ID': 507326, '名前': 'EPS1'},
   {'ID': 104582, '名前': '事務室 1, 2, 3'},
   {'ID': 205713, '名前': 'EPS3'},
   {'ID': 396824, '名前': '事務室 1, 2, 3'},
   {'ID': 587935, '名前': 'WC'},
   {'ID': 768046, '名前': '事務室 1, 2, 3'}]
  ```

### 参考例（ルール適用イメージ）

* 'Office-1', 'Office-２', 'Office-10', 'Office-06'
  → ベース名：'Office'（接尾型）
  → 出力例：'Office -1, 2, 06, 10'（数値昇順、'06'保持）
* '保管室西', '保管室東'
  → ベース名：'保管室'（接尾型, C=短いトークン）
  → 出力例：'保管室 西, 東'
* '北テラス', '東テラス', '南ギャラリー3', '北東ギャラリー01', '北ギャラリー', '北東ギャラリー', 
  → ベース名：'テラス'（接頭型） / 'ギャラリー'（接頭型）
  → 出力例：'北, 東 テラス' / '北, 北東, 南_01, 南_3 ギャラリー'
* 'ServerZone_1', 'ServerZone_2', 'ServerZone_Main'
  → '_1', '_2' はまとめ可、'_Main' は不許可（個別）
  → 出力例：'ServerZone _1, _2' と 'ServerZone_Main'（別扱い）
